# Promo Code Manager API

Backend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –Ω–∞ –±–∞–∑–µ NestJS.

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- pnpm (–∏–ª–∏ npm/yarn)
- Docker –∏ Docker Compose

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pnpm install
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```bash
cp env.example .env
```

–§–∞–π–ª `.env` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è.

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Docker Compose:

```bash
docker-compose up -d
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- **MongoDB** (–ø–æ—Ä—Ç 27017) - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –ë–î
- **ClickHouse** (–ø–æ—Ä—Ç—ã 8123, 9000) - –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ë–î
- **Redis** (–ø–æ—Ä—Ç 6379) - –¥–ª—è EventBus –∏ –æ—á–µ—Ä–µ–¥–µ–π
- **ClickHouse Init** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker-compose ps
```

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ `Up` –∏ `healthy`.

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ ClickHouse –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

ClickHouse –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker logs promo_code_manager_clickhouse_init
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** Init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∂–¥—ë—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ ClickHouse (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 10-30 —Å–µ–∫—É–Ω–¥). –í –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
üöÄ ClickHouse Init Script
Target container: promo_code_manager_clickhouse
Waiting for ClickHouse to be ready...
‚è≥ ClickHouse is not ready yet, waiting... (5/60)
‚è≥ ClickHouse is not ready yet, waiting... (10/60)
...
‚úÖ ClickHouse is ready!
üì¶ Applying migrations...
Creating database 'analytics'...
Creating tables...
‚úÖ Migrations completed successfully!
üìä Verifying tables...
orders_analytics
promo_code_usages_analytics
users_analytics
```

**–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**, –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
docker exec promo_code_manager_clickhouse clickhouse-client --database=analytics --query "SHOW TABLES"
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã —Ç–∞–±–ª–∏—Ü—ã:
- `promo_code_usages_analytics`
- `orders_analytics`
- `users_analytics`

**–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã** (init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –Ω–µ —É—Å–ø–µ—Ç—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞), –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é:

```bash
# –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
docker exec promo_code_manager_clickhouse clickhouse-client --query "CREATE DATABASE IF NOT EXISTS analytics"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
Get-Content clickhouse/init/001-create-tables.sql | docker exec -i promo_code_manager_clickhouse clickhouse-client --database=analytics --multiquery
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ClickHouse. –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã —Å—Ä–∞–∑—É, –ø–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 —Å–µ–∫—É–Ω–¥ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–Ω–æ–≤–∞.

**–î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã):

```bash
docker-compose stop clickhouse-init
docker-compose rm -f clickhouse-init
docker-compose up -d clickhouse-init
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å hot-reload)
pnpm run start:dev

# Production —Ä–µ–∂–∏–º
pnpm run start:prod
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:3000`

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

#### Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:3000/docs`

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl http://localhost:3000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ClickHouse
curl http://localhost:8123/ping
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Ctrl+C)

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volumes (‚ö†Ô∏è —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ)
docker-compose down -v
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ main.ts                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ app.module.ts              # –ö–æ—Ä–Ω–µ–≤–æ–π –º–æ–¥—É–ª—å
‚îÇ
‚îú‚îÄ‚îÄ common/                     # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ config/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (CORS, Swagger)
‚îÇ   ‚îú‚îÄ‚îÄ decorators/            # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (auth, response, validation)
‚îÇ   ‚îú‚îÄ‚îÄ dto/                   # –û–±—â–∏–µ DTO
‚îÇ   ‚îú‚îÄ‚îÄ filters/               # Exception filters
‚îÇ   ‚îú‚îÄ‚îÄ interceptors/         # Response interceptors
‚îÇ   ‚îî‚îÄ‚îÄ paginate/             # –£—Ç–∏–ª–∏—Ç—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
‚îÇ
‚îî‚îÄ‚îÄ modules/                   # –ë–∏–∑–Ω–µ—Å-–º–æ–¥—É–ª–∏
    ‚îú‚îÄ‚îÄ users/                 # –ú–æ–¥—É–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ‚îÇ   ‚îú‚îÄ‚îÄ api/               # API —Å–ª–æ–π (controllers, dto)
    ‚îÇ   ‚îú‚îÄ‚îÄ application/       # Application —Å–ª–æ–π (services)
    ‚îÇ   ‚îú‚îÄ‚îÄ domain/            # Domain —Å–ª–æ–π (entities)
    ‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/    # Infrastructure —Å–ª–æ–π (repositories, schemas)
    ‚îÇ
    ‚îú‚îÄ‚îÄ auth/                  # –ú–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ api/               # Controllers, DTOs
    ‚îÇ   ‚îú‚îÄ‚îÄ application/       # AuthService
    ‚îÇ   ‚îú‚îÄ‚îÄ domain/            # JWT interfaces, constants
    ‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/    # Guards, Strategies (JWT, Local)
    ‚îÇ
    ‚îú‚îÄ‚îÄ promo-codes/           # –ú–æ–¥—É–ª—å –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ api/               # Controllers, DTOs
    ‚îÇ   ‚îú‚îÄ‚îÄ application/       # Services, Use Cases, Events
    ‚îÇ   ‚îú‚îÄ‚îÄ domain/            # Domain Entity, Constants
    ‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/    # Repositories, Schemas, Consumers
    ‚îÇ
    ‚îú‚îÄ‚îÄ orders/                # –ú–æ–¥—É–ª—å –∑–∞–∫–∞–∑–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ api/               # Controllers, DTOs
    ‚îÇ   ‚îú‚îÄ‚îÄ application/       # Services, Use Cases, Events
    ‚îÇ   ‚îú‚îÄ‚îÄ domain/            # Domain Entity
    ‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/    # Repositories, Schemas, Consumers
    ‚îÇ
    ‚îú‚îÄ‚îÄ analytics/             # –ú–æ–¥—É–ª—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ api/               # Controllers, DTOs
    ‚îÇ   ‚îú‚îÄ‚îÄ application/       # AnalyticsService (–∑–∞–ø—Ä–æ—Å—ã –∫ ClickHouse)
    ‚îÇ   ‚îî‚îÄ‚îÄ infrastructure/    # Consumers (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ users_analytics)
    ‚îÇ
    ‚îî‚îÄ‚îÄ shared/                # –û–±—â–∏–µ –º–æ–¥—É–ª–∏
        ‚îú‚îÄ‚îÄ database/          # MongoDB, ClickHouse —Å–µ—Ä–≤–∏—Å—ã
        ‚îî‚îÄ‚îÄ events/            # EventBus (Redis/Bull)
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π (Clean Architecture)

–ö–∞–∂–¥—ã–π –±–∏–∑–Ω–µ—Å-–º–æ–¥—É–ª—å —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clean Architecture:

```
module/
‚îú‚îÄ‚îÄ domain/              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—á–∏—Å—Ç–∞—è, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
‚îÇ   ‚îú‚îÄ‚îÄ entity/          # Domain entities —Å –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ constants/       # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–æ–º–µ–Ω–∞
‚îÇ
‚îú‚îÄ‚îÄ application/         # Use Cases –∏ Application Services
‚îÇ   ‚îú‚îÄ‚îÄ services/       # Application services
‚îÇ   ‚îú‚îÄ‚îÄ use-cases/      # Use Cases (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ events/         # –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
‚îÇ
‚îú‚îÄ‚îÄ infrastructure/      # –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ repositories/    # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (MongoDB)
‚îÇ   ‚îú‚îÄ‚îÄ schemas/        # Mongoose schemas
‚îÇ   ‚îî‚îÄ‚îÄ consumers/      # Event consumers (ClickHouse)
‚îÇ
‚îî‚îÄ‚îÄ api/                # API —Å–ª–æ–π
    ‚îú‚îÄ‚îÄ controllers/    # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
    ‚îî‚îÄ‚îÄ dto/            # Data Transfer Objects
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

**MongoDB (OLTP)** ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤, –∑–∞–∫–∞–∑–æ–≤
- CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

**ClickHouse (OLAP)** ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:
- –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** Event-Driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–µ—Ä–µ–∑ Redis/BullMQ

### 2. Event-Driven —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è MongoDB ‚Üí ClickHouse

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MongoDB   ‚îÇ (OLTP - –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ –°–æ–∑–¥–∞–Ω–∏–µ/–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   EventBus (Redis/Bull)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Consumers     ‚îÇ
‚îÇ   (Bull Queue)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ –ó–∞–ø–∏—Å—å –≤ ClickHouse
       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ClickHouse    ‚îÇ (OLAP - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–°–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è** –ø—Ä–∏ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏—è—Ö:
   - `PromoCodeAppliedEvent` ‚Äî –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
   - `OrderCreatedEvent` ‚Äî –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

2. **Use Cases –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—Ç** –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—é —Å–æ–±—ã—Ç–∏–π:
   ```typescript
   // ApplyPromoCodeUseCase
   async execute() {
     // 1. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—á–µ—Ä–µ–∑ Service)
     const result = await this.service.applyPromoCode(...);
     
     // 2. –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
     await this.eventBus.publish(new PromoCodeAppliedEvent(...));
     
     return result;
   }
   ```

3. **Consumers –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç** —Å–æ–±—ã—Ç–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:
   ```typescript
   @Process('PromoCodeAppliedEvent')
   async handle(event: PromoCodeAppliedEvent) {
     await this.clickhouse.insert('promo_code_usages_analytics', {
       // –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
     });
   }
   ```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
- ‚úÖ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å ‚Äî retry –º–µ—Ö–∞–Ω–∏–∑–º —á–µ—Ä–µ–∑ Bull
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ consumers
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ ‚Äî OLTP –∏ OLAP –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã

### 3. Domain-Driven Design

**Domain Entities** —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É:

```typescript
// PromoCode Entity
class PromoCode {
  validateUsage(userId: string, userUsageCount: number): void {
    if (!this.isActive) throw new BadRequestException('Not active');
    if (this.usedCount >= this.totalLimit) throw new BadRequestException('Limit exceeded');
    // ... –¥—Ä—É–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞
  }
  
  calculateDiscount(amount: number): number {
    return (amount * this.discountPercent) / 100;
  }
}
```

**Use Cases** –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã:
- –û—Ç–¥–µ–ª—è—é—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –£–ø—Ä–æ—â–∞—é—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£–ª—É—á—à–∞—é—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ClickHouse

**–ü—Ä–æ–±–ª–µ–º–∞:** ClickHouse –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∫ PostgreSQL.

**–†–µ—à–µ–Ω–∏–µ:** Init-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:
1. –ñ–¥—ë—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ ClickHouse (healthcheck)
2. –°–æ–∑–¥–∞—ë—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `analytics`
3. –ü—Ä–∏–º–µ–Ω—è–µ—Ç SQL-–º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ `clickhouse/init/001-create-tables.sql`

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```yaml
clickhouse-init:
  image: curlimages/curl:latest
  depends_on:
    clickhouse:
      condition: service_healthy  # –ñ–¥—ë—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
  entrypoint: ["/bin/sh", "/schema/init-http.sh"]
  restart: "no"  # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
```

**–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `IF NOT EXISTS` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

### 5. JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤:**
- **Access Token** (15 –º–∏–Ω—É—Ç) ‚Äî –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- **Refresh Token** (7 –¥–Ω–µ–π) ‚Äî –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access token

**–ó–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤:**
- `@JwtAuth()` ‚Äî –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∑–∞—â–∏—Ç—ã —Ä–æ—É—Ç–æ–≤
- `@Public()` ‚Äî –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- `@CurrentUser()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ Race Conditions –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** ‚úÖ **MongoDB —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **MongoDB —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
2. **–ê—Ç–æ–º–∞—Ä–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ª–∏–º–∏—Ç–∞ —á–µ—Ä–µ–∑ `findOneAndUpdate` —Å —É—Å–ª–æ–≤–∏–µ–º
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback** –µ—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω

**–ì–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `ApplyPromoCodeUseCase.execute()` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MongoDB —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `PromoCodeRepository.incrementUsageIfWithinLimit()` ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
- `BaseRepository` ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ—Å—Å–∏–π –≤–æ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–∞—Ö

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [README.md](../../README.md#6-–æ–±—Ä–∞–±–æ—Ç–∫–∞-race-conditions-–ø—Ä–∏-–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏-–ø—Ä–æ–º–æ–∫–æ–¥–∞)

### 7. Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- –î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:3000/docs`
- –í—Å–µ endpoints –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞

### 8. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ì–ª–æ–±–∞–ª—å–Ω—ã–π Exception Filter:**
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ class-validator

**Response Interceptor:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—ë—Ä—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –≤ `{ result: ... }`
- –£–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å API –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

## üìä –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### MongoDB

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Compass:**
```
mongodb://admin:admin123@localhost:27017/promo_code_manager?authSource=admin
```

**–†–µ–∫–≤–∏–∑–∏—Ç—ã:**
- Host: `localhost`
- Port: `27017`
- Username: `admin`
- Password: `admin123`
- Database: `promo_code_manager`

### ClickHouse

**–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö:**

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ ClickHouse
docker exec -it promo_code_manager_clickhouse clickhouse-client --database=analytics

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
SHOW TABLES;

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ
SELECT * FROM promo_code_usages_analytics LIMIT 10;
SELECT * FROM orders_analytics LIMIT 10;
```

**HTTP API:**
```bash
curl "http://localhost:8123/?database=analytics&query=SHOW+TABLES"
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [ClickHouse Guide](../../documentation/clickhouse-guide.md)

### Redis

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
```bash
docker exec promo_code_manager_redis redis-cli ping
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Unit —Ç–µ—Å—Ç—ã
pnpm run test

# E2E —Ç–µ—Å—Ç—ã
pnpm run test:e2e

# –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
pnpm run test:cov

# –¢–µ—Å—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è
pnpm run test -- promo-codes
```

**–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:**
- ‚úÖ Users Module ‚Äî –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- ‚úÖ Auth Module ‚Äî –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- ‚úÖ Promo Codes Module ‚Äî 41 —Ç–µ—Å—Ç (service, controller, use case, consumer)
- ‚úÖ Orders Module ‚Äî 40 —Ç–µ—Å—Ç–æ–≤ (service, controller, use case, consumer)
- ‚úÖ Analytics Module ‚Äî 24 —Ç–µ—Å—Ç–∞ (service, controller, consumer)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ Analytics Module: –¥–æ–±–∞–≤–ª–µ–Ω `AnalyticsRepository` –¥–ª—è –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ ClickHouse
- ‚úÖ Promo Codes Module: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `OrderRepository` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É: Repository ‚Üí Service ‚Üí Use Case
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ ESLint, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å `any` —Ç–∏–ø–∞–º–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–æ –≤—Å–µ—Ö —Ç–µ—Å—Ç–∞—Ö

## üìù API Endpoints

### Auth
- `POST /auth/register` ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /auth/login` ‚Äî –í—Ö–æ–¥
- `POST /auth/refresh` ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `GET /auth/me` ‚Äî –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

### Users
- `POST /users` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /users` ‚Äî –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
- `GET /users/:id` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PATCH /users/:id` ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `DELETE /users/:id` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Promo Codes
- `POST /promo-codes` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `GET /promo-codes` ‚Äî –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
- `GET /promo-codes/:id` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `PATCH /promo-codes/:id` ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `DELETE /promo-codes/:id` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
- `POST /promo-codes/apply` ‚Äî –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞

### Orders
- `POST /orders` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `GET /orders` ‚Äî –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏, –ø–∞–≥–∏–Ω–∞—Ü–∏—è)
- `GET /orders/:id` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (—Ç–æ–ª—å–∫–æ —Å–≤–æ–π)
- `PATCH /orders/:id` ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (—Ç–æ–ª—å–∫–æ —Å–≤–æ–π)
- `DELETE /orders/:id` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (—Ç–æ–ª—å–∫–æ —Å–≤–æ–π)

### Analytics
- `GET /analytics/promo-codes` ‚Äî –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π (–ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º)
- `GET /analytics/promo-codes/:id/stats` ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É (—Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º)
- `GET /analytics/users` ‚Äî –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π (–ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º)
- `GET /analytics/promo-code-usages` ‚Äî –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (–ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–∞–º –∏ –ø—Ä–æ–º–æ–∫–æ–¥—É)

–í—Å–µ endpoints –∑–∞—â–∏—â–µ–Ω—ã JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π (–∫—Ä–æ–º–µ `/auth/register` –∏ `/auth/login`).

## üîß –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pnpm install

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pnpm run start:dev

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
pnpm run build

# –ó–∞–ø—É—Å–∫ production
pnpm run start:prod

# –õ–∏–Ω—Ç–∏–Ω–≥
pnpm run lint

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
pnpm run format

# –¢–µ—Å—Ç—ã
pnpm run test
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Database Setup](../../documentation/database-setup.md)
- [ClickHouse Guide](../../documentation/clickhouse-guide.md)
- [Event Bus & Queue System](../../documentation/event-bus-queue-clickhouse.md)
- [CHANGELOG](../../documentation/CHANGELOG.md)
