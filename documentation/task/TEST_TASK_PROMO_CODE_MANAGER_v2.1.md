# Тестовое задание: Мини-приложение "PromoCode Manager"

**Длительность:** 8-10 часов
**Результат:** Публичный Git-репозиторий с готовым проектом

---

## Цель

Создать fullstack приложение для управления промокодами с аналитикой. Задание проверяет понимание двухуровневой архитектуры данных: основная БД для CRUD операций, аналитическая БД для отчётов и таблиц.

---

## Технический стек

| Слой           | Технологии                                                                            |     |
| -------------- | ------------------------------------------------------------------------------------- | --- |
| Backend        | NestJS, TypeScript, Mongoose, @clickhouse/client                                      |     |
| Frontend       | React (или Preact), TypeScript, MUI, material-react-table — SPA, без SSR (не Next.js) |     |
| Базы данных    | MongoDB, ClickHouse, Redis                                                            |     |
| Инфраструктура | Docker Compose                                                                        |     |

---

## Бизнес-требования

### Сущности

**Пользователи:**
- Базовая информация (email, имя, телефон)
- Пароль (хранится в хэшированном виде)
- Статус активности

**Промокоды:**
- Уникальный код (например, "SUMMER2024")
- Процент скидки
- Лимиты использования (общий и на пользователя)
- Срок действия (опционально: дата начала и окончания)
- Статус активности

**Заказы (упрощённые):**
- Принадлежность пользователю (для агрегации статистики)
- Сумма заказа
- Применённый промокод (опционально)
- Дата создания
- Реализация может быть моковой — главное, чтобы были данные для аналитики

**Использования промокодов:**
- Какой промокод, кем и к какому заказу применён
- Рассчитанная сумма скидки
- Дата использования

### Функциональность

**Авторизация и регистрация:**
- Регистрация нового пользователя (email, пароль, имя, телефон)
- Вход по email и паролю
- JWT токены для аутентификации запросов
- Защита API endpoints (только авторизованные пользователи)

**CRUD операции:**
- Создание, чтение, обновление, деактивация пользователей и промокодов

**Применение промокода:**
- Endpoint для применения промокода к заказу
- Валидация: существование, активность, лимиты, срок действия
- Расчёт и сохранение скидки

**Аналитические таблицы (данные из ClickHouse):**
- Таблица пользователей с агрегированной статистикой (заказы, суммы, использованные промокоды)
- Таблица промокодов с метриками эффективности (использования, выручка, уникальные пользователи)
- История использований промокодов

**Требования к таблицам:**
- Server-side пагинация, сортировка, фильтрация
- Глобальный фильтр по диапазону дат (важно для производительности ClickHouse)
- Пресеты дат: "Сегодня", "Последние 7 дней", "Последние 30 дней", "Произвольный"

### Архитектура данных

Ключевой аспект задания — разделение ответственности между базами данных:
- **MongoDB** — источник истины, CRUD операции
- **ClickHouse** — аналитика, агрегаты, отображение в таблицах

Как организовать синхронизацию данных между базами — решение за вами.

---

## Критерии оценки

| Критерий | Вес | Описание |
|----------|-----|----------|
| **Архитектура** | 25% | Разделение модулей, понимание MongoDB ↔ ClickHouse |
| **TypeScript** | 20% | Строгая типизация, корректные DTO |
| **Backend качество** | 20% | Валидация, обработка ошибок, чистый код |
| **Frontend качество** | 20% | Работа с таблицами, hooks, компоненты |
| **Работоспособность** | 15% | Приложение запускается и корректно работает |

> **Примечание:** Модули Users и Orders оцениваются только на базовую работоспособность.

**Бонусные баллы:**
- Swagger документация
- Unit тесты
- Автоматическая инициализация таблиц ClickHouse
- Обработка race conditions при применении промокода
- Оптимистичный UI

---

## Что предоставить

1. Ссылка на публичный GitHub репозиторий
2. README с инструкцией запуска (Docker Compose для БД, команды для backend/frontend)
3. Краткое описание принятых архитектурных решений

---

